<div class="expense-dialog">
  <button mat-icon-button class="close-btn" (click)="close()" aria-label="Cerrar">
    <mat-icon>close</mat-icon>
  </button>
  <div *ngIf="step === 1">
    <!-- Modo upload -->
    <ng-container *ngIf="mode === 'upload'">
      <h2>Sube o arrastra tu recibo</h2>
      <input type="file" accept="image/*" (change)="onFileSelected($event)" />
      <button (click)="processReceipt()" [disabled]="!selectedFile">Procesar</button>
      <button (click)="close()">Cerrar</button>
      <div *ngIf="loading">Procesando con Gemini...</div>
    </ng-container>

    <!-- Modo cÃ¡mara -->
    <ng-container *ngIf="mode === 'camera'">
      <h2>Escanea tu recibo</h2>
      <video #video width="300" height="200" autoplay *ngIf="!loading"></video>
      <canvas #canvas width="300" height="200" [style.display]="loading ? 'block' : 'none'"></canvas>
      <button (click)="capturePhoto()" [disabled]="loading">Capturar foto</button>
      <button (click)="close()">Cerrar</button>
      <div *ngIf="loading">Procesando con Gemini...</div>
    </ng-container>
  </div>

  <div *ngIf="step === 2">
    <h2>{{ mode === 'manual' ? 'Agrega tu gasto' : 'Revisa y edita tu gasto' }}</h2>
    <app-expense-form
      [initialData]="parsedExpense ?? undefined"
      (save)="onSave($event)"
      (cancel)="onCancel()"
    ></app-expense-form>
  </div>
</div>
