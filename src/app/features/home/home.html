<div class="home-container">
  <!-- Header con mensaje de bienvenida -->
  <div class="welcome-section">
    <h1 class="welcome-title">{{ welcomeMessage }}</h1>
    <p class="welcome-subtitle">Aqu칤 est치 el resumen de tus finanzas</p>
  </div>

  <!-- Tip de la semana -->
  <mat-card class="tip-card" appearance="outlined">
    <div class="tip-content" *ngIf="!loading && dashboardData?.data?.weekly_tip">
      <div class="tip-icon">游눠</div>
      <div class="tip-text">
        <h3 class="tip-title">{{ dashboardData.data.weekly_tip.title }}</h3>
        <p class="tip-message">{{ dashboardData.data.weekly_tip.message }}</p>
      </div>
    </div>

    <!-- Skeleton para tip -->
    <div class="tip-skeleton" *ngIf="loading">
      <div class="skeleton-icon"></div>
      <div class="skeleton-text">
        <div class="skeleton-line skeleton-title"></div>
        <div class="skeleton-line skeleton-message"></div>
      </div>
    </div>
  </mat-card>

  <!-- KPIs y Gr치fico de gastos -->
  <div class="dashboard-grid">

    <!-- Presupuesto restante -->
    <mat-card class="budget-card" appearance="outlined">
      <div class="card-header">
        <mat-icon class="card-icon">account_balance_wallet</mat-icon>
        <h3 class="card-title">Presupuesto de {{ currentMonth }}</h3>
      </div>

      <!-- Contenido real -->
      <div class="budget-content" *ngIf="!loading && dashboardData?.data?.budget">
        <div class="budget-amount">
          <span class="amount-label">Restante</span>
          <span class="amount-value"
                [class.low]="dashboardData.data.budget.percentage > 80">
            {{ dashboardData.data.budget.remaining | currency }}
          </span>
        </div>

        <div class="budget-bar">
          <div class="budget-bar-fill"
               [style.width.%]="dashboardData.data.budget.percentage"></div>
        </div>

        <div class="budget-details">
          <span class="detail-item">
            <span class="detail-label">Gastado:</span>
            <span class="detail-value">{{ formatCurrency(dashboardData.data.budget.spent) }}</span>
          </span>
          <span class="detail-item">
            <span class="detail-label">Total:</span>
            <span class="detail-value">{{ formatCurrency(dashboardData.data.budget.total) }}</span>
          </span>
        </div>
      </div>

      <!-- Skeleton para presupuesto -->
      <div class="budget-skeleton" *ngIf="loading">
        <div class="skeleton-amount"></div>
        <div class="skeleton-bar"></div>
        <div class="skeleton-details">
          <div class="skeleton-detail"></div>
          <div class="skeleton-detail"></div>
        </div>
      </div>
    </mat-card>

    <!-- Gr치fico de gastos diarios -->
    <mat-card class="chart-card" appearance="outlined">
      <div class="card-header">
        <mat-icon class="card-icon">show_chart</mat-icon>
        <h3 class="card-title">Gastos diarios de {{ currentMonth }}</h3>
      </div>

      <!-- Contenido real: gr치fico -->
      <div class="chart-container" *ngIf="!loading && dashboardData?.data">
        <div class="chart-canvas-wrapper" *ngIf="dailyExpenses.length > 0">
          <canvas #dailyExpensesChart></canvas>
        </div>

        <!-- Estado vac칤o -->
        <div class="chart-empty" *ngIf="dailyExpenses.length === 0">
          <mat-icon class="empty-icon">insights</mat-icon>
          <h3 class="empty-title">A칰n no tienes gastos este mes</h3>
          <p class="empty-text">Comienza a registrar tus gastos para ver el an치lisis diario</p>
          <button mat-flat-button color="primary" (click)="goToScanner()">
            <mat-icon>add</mat-icon>
            Registrar primer gasto
          </button>
        </div>

        <div class="chart-summary" *ngIf="dailyExpenses.length > 0">
          <span class="summary-text">
            Total gastado hasta hoy: <strong>{{ formatCurrency(dashboardData.data.budget.spent) }}</strong>
          </span>
        </div>
      </div>

      <!-- Skeleton para gr치fico -->
      <div class="chart-skeleton" *ngIf="loading">
        <div class="skeleton-chart"></div>
        <div class="skeleton-summary"></div>
      </div>
    </mat-card>
  </div>

  <!-- Acceso directo a escaneo -->
  <mat-card class="scanner-card" appearance="outlined">
    <div class="scanner-content">
      <div class="scanner-info">
        <mat-icon class="scanner-icon">qr_code_scanner</mat-icon>
        <div class="scanner-text">
          <h3 class="scanner-title">Registra tus gastos r치pidamente</h3>
          <p class="scanner-description">Escanea tus recibos y registra autom치ticamente</p>
        </div>
      </div>
      <button mat-raised-button color="primary" class="scanner-button" (click)="goToScanner()">
        <mat-icon>camera_alt</mat-icon>
        Escanear ahora
      </button>
    </div>
  </mat-card>

  <!-- Recordatorios de pagos/deudas -->
  <div class="debts-section">
    <div class="section-header">
      <div class="section-title-wrapper">
        <mat-icon class="section-icon">notifications_active</mat-icon>
        <h2 class="section-title">Pr칩ximos pagos</h2>
        <h2 *ngIf="!loading && dashboardData?.data"
            class="debt-count">{{ dashboardData.data.upcoming_payments.length }}</h2>
      </div>
      <div class="button-debt-group">
        <button mat-stroked-button color="primary" class="notifications-btn" (click)="openAddDebtDialog()">
          <mat-icon>add_alert</mat-icon>
          Nueva alerta
        </button>

        <button mat-stroked-button color="accent" class="notifications-btn" (click)="openViewDebtsDialog()">
          <mat-icon>notifications_active</mat-icon>
          Ver alertas
        </button>
      </div>
    </div>

    <!-- Lista real de pagos -->
    <div class="debts-list" *ngIf="!loading && dashboardData?.data">
      <mat-card
        *ngFor="let payment of dashboardData.data.upcoming_payments"
        class="debt-card"
        [ngClass]="getDebtUrgencyClass(payment.payment_day)"
        appearance="outlined">
        <div class="debt-content">
          <div class="debt-info">
            <div class="debt-urgency-indicator"></div>
            <div class="debt-details">
              <h4 class="debt-name">{{ payment.name }}</h4>
              <div class="debt-meta">
                <span class="debt-date">
                  <mat-icon class="meta-icon">event</mat-icon>
                  {{ getPaymentDate(payment.payment_day) | date:'dd/MM/yyyy' }}
                </span>
                <span class="debt-days" [ngClass]="getDebtUrgencyClass(payment.payment_day)">
                  <mat-icon class="meta-icon">schedule</mat-icon>
                  {{ getDaysUntilPayment(payment.payment_day) }} d칤as restantes
                </span>
              </div>
            </div>
          </div>

          <div class="debt-actions">
            <span class="debt-amount">{{ formatCurrency(payment.amount) }}</span>
            <button
              mat-flat-button
              color="primary"
              class="pay-button"
              (click)="openPaymentDialog(payment)">
              <mat-icon>payment</mat-icon>
              Pagar
            </button>
          </div>
        </div>
      </mat-card>

      <div *ngIf="dashboardData.data.upcoming_payments.length === 0" class="empty-debts">
        <mat-icon class="empty-icon">check_circle</mat-icon>
        <p class="empty-text">No tienes pagos pendientes</p>
        <button mat-stroked-button color="primary" (click)="openAddDebtDialog()">
          Agregar tu primer pago
        </button>
      </div>
    </div>

    <!-- Skeleton para lista de pagos -->
    <div class="debts-skeleton" *ngIf="loading">
      <div class="skeleton-debt-card" *ngFor="let item of [1,2,3]">
        <div class="skeleton-debt-left">
          <div class="skeleton-debt-indicator"></div>
          <div class="skeleton-debt-info">
            <div class="skeleton-line skeleton-debt-name"></div>
            <div class="skeleton-line skeleton-debt-meta"></div>
          </div>
        </div>
        <div class="skeleton-debt-right">
          <div class="skeleton-debt-amount"></div>
          <div class="skeleton-debt-button"></div>
        </div>
      </div>
    </div>
  </div>
</div>
