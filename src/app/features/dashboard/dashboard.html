<!-- dashboard.html -->
<div class="dashboard-container">

  <!-- Header Section -->
  <div class="header-section">
    <div class="welcome-message">
      <h1>Hola {{ userName }}</h1>
      <p class="subtitle">Aqui puedes ver tus estadisticas</p>
    </div>

    <div class="notifications-section">
      <button mat-stroked-button class="notifications-btn" (click)="viewNotifications()">
        <mat-icon [matBadge]="unreadNotifications" matBadgeColor="accent" [matBadgeHidden]="unreadNotifications === 0">
          inbox
        </mat-icon>
        <span class="notifications-text"> notificaciones </span>
      </button>
      <button mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="viewAllNotifications()">Ver todas</button>
        <button mat-menu-item>Marcar como leídas</button>
      </mat-menu>
      <!-- Panel de notificaciones -->
      <app-notifications-panel
        *ngIf="showNotificationPanel"
        (closePanel)="closeNotificationPanel()">
      </app-notifications-panel>

    </div>
  </div>

  <!-- KPIs Grid -->
  <div class="kpis-grid">
    <mat-card class="kpi-card">
      <mat-card-content>
        <div class="kpi-label">Total gastado este mes</div>
        <div class="kpi-value">S/ {{ totalGastadoMes }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card">
      <mat-card-content>
        <div class="kpi-label">Categoría más alta</div>
        <div class="kpi-value category">{{ categoriaMasAlta }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card">
      <mat-card-content>
        <div class="kpi-label">Presupuesto restante</div>
        <div class="kpi-value" [ngClass]="{ 'critico': isPresupuestoCritico }">
          S/ {{ presupuestoRestante }}
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card">
      <mat-card-content>
        <div class="kpi-label">Proyección de gastos del próximo mes</div>
        <div class="kpi-value">
          S/ {{ proyeccionProximoMes }}
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts Grid -->
  <mat-grid-list [cols]="gridCols" rowHeight="400px" [gutterSize]="'20px'">

    <mat-grid-tile [colspan]="mainChartCols" [rowspan]="1">
      <mat-card class="chart-card flip-card" [class.flipped]="showBackCategorias">
        <div class="flip-card-inner">

          <!-- Cara frontal -->
          <div class="flip-card-front">
            <mat-card-header>
              <mat-card-title>Distribución de gastos por minicategorías</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('categorias')">
                Ver descripción
              </button>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas id="categoriasChart"></canvas>
              </div>
            </mat-card-content>
          </div>

          <!-- Cara trasera -->
          <div class="flip-card-back">
            <mat-card-header>
              <mat-card-title>Descripción del gráfico</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('categorias')">
                Volver al gráfico
              </button>
            </mat-card-header>
            <mat-card-content>
              <p>
                Este gráfico muestra la distribución de gastos clasificados en
                diferentes <b>minicategorías</b>, ayudándote a identificar en qué
                áreas específicas concentras más tus gastos.
              </p>
            </mat-card-content>
          </div>

        </div>
      </mat-card>
    </mat-grid-tile>


    <mat-grid-tile [colspan]="sideChartCols" [rowspan]="1">
      <mat-card class="chart-card flip-card" [class.flipped]="showBackAhorro">
        <div class="flip-card-inner">

          <!-- Cara frontal -->
          <div class="flip-card-front">
            <mat-card-header>
              <mat-card-title>Evolución de ahorro</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('ahorro')">
                Ver descripción
              </button>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas id="ahorroCanvas"></canvas>
              </div>
            </mat-card-content>
          </div>

          <!-- Cara trasera -->
          <div class="flip-card-back">
            <mat-card-header>
              <mat-card-title>Descripción del gráfico</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('ahorro')">
                Volver al gráfico
              </button>
            </mat-card-header>
            <mat-card-content>
              <p>
                Este gráfico muestra la <b>evolución del ahorro mes a mes</b>,
                ayudándote a identificar los meses donde acumulaste más saldo
                o tuviste pérdidas.
              </p>
            </mat-card-content>
          </div>

        </div>
      </mat-card>
    </mat-grid-tile>


    <mat-grid-tile [colspan]="1" [rowspan]="1">
      <mat-card class="chart-card flip-card" [class.flipped]="showBackPadres">
        <div class="flip-card-inner">

          <!-- Cara frontal -->
          <div class="flip-card-front">
            <mat-card-header>
              <mat-card-title>Proporción de categorías padres</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('padres')">
                Ver descripción
              </button>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas id="proporcionChart"></canvas>
              </div>
            </mat-card-content>
          </div>

          <!-- Cara trasera -->
          <div class="flip-card-back">
            <mat-card-header>
              <mat-card-title>Descripción del gráfico</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('padres')">
                Volver al gráfico
              </button>
            </mat-card-header>
            <mat-card-content>
              <p>
                Este gráfico muestra la <b>proporción de gastos agrupados por categorías padres</b>,
                permitiéndote analizar qué grandes áreas de tu presupuesto concentran mayor gasto
                (ej. vivienda, transporte, alimentación).
              </p>
            </mat-card-content>
          </div>

        </div>
      </mat-card>
    </mat-grid-tile>


    <mat-grid-tile [colspan]="1" [rowspan]="1">
      <mat-card class="chart-card flip-card" [class.flipped]="showBackProyeccion">
        <div class="flip-card-inner">

          <!-- Cara frontal -->
          <div class="flip-card-front">
            <mat-card-header>
              <mat-card-title>Predicción de gastos por mes</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('proyeccion')">
                Ver descripción
              </button>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas id="prediccionChart"></canvas>
              </div>
            </mat-card-content>
          </div>

          <!-- Cara trasera -->
          <div class="flip-card-back">
            <mat-card-header>
              <mat-card-title>Descripción del gráfico</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('proyeccion')">
                Volver al gráfico
              </button>
            </mat-card-header>
            <mat-card-content>
              <p>
                Este gráfico muestra la <b>predicción de tus gastos para los próximos meses</b>,
                basada en el historial de consumo. Te permite anticipar posibles desbalances
                y planificar mejor tu presupuesto.
              </p>
            </mat-card-content>
          </div>

        </div>
      </mat-card>
    </mat-grid-tile>


    <mat-grid-tile [colspan]="lastChartCols" [rowspan]="1">
      <mat-card class="chart-card flip-card" [class.flipped]="showBackEsenciales">
        <div class="flip-card-inner">

          <!-- Cara frontal -->
          <div class="flip-card-front">
            <mat-card-header>
              <mat-card-title>Gastos esenciales vs no esenciales</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('esenciales')">
                Ver descripción
              </button>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas id="esencialesChart"></canvas>
              </div>
            </mat-card-content>
          </div>

          <!-- Cara trasera -->
          <div class="flip-card-back">
            <mat-card-header>
              <mat-card-title>Descripción del gráfico</mat-card-title>
              <button mat-button class="filter-btn" (click)="toggleFlip('esenciales')">
                Volver al gráfico
              </button>
            </mat-card-header>
            <mat-card-content>
              <p>
                Este gráfico compara tus <b>gastos esenciales</b> (como vivienda, alimentación, transporte)
                frente a los <b>no esenciales</b> (ocio, entretenimiento, compras extra).
                Te ayuda a mantener un balance saludable entre necesidades básicas y gastos discrecionales.
              </p>
            </mat-card-content>
          </div>

        </div>
      </mat-card>
    </mat-grid-tile>


  </mat-grid-list>

</div>
